# Introduction

## Motivation

Ethereum is a new blockchain inspired by Bitcoin, with the design goal of abstracting away transaction complexity and allowing for easy programmatic interaction through the use of a virtual machine and relying upon the state of this virtual machine rather than dealing with transaction outputs; transactions merely modify the state.

This idea of a global computer allows one to write a program, hereinafter a Smart Contract, which interacts with the EVM and inherits the safety properties of the Ethereum system---as well as its limitations. Fundamentally it is a very low power and low capacity computing platform with interesting safety properties---such as operations and state data being essentially immutable once a transaction is included in the blockchain (with sufficient confirmations as it's probabilistic after all). This is ideally suited to small minimalistic programs governing essential data, such as a ledger of transactions.

One such example of smart contracts is the ERC20 token standard (there are varying smart contract implementations). This is likely the most widely deployed type of smart contract on Ethereum. One issue is the design of ERC20. The way to transfer tokens to an externally owned address or a contract address differs and transferring tokens to a contract, while assuming it is a regular address, can result in losing those tokens forever. In consequence, this limits the way smart contracts can interact with ERC20 tokens and adds complexity to the \gls{ux}.

The new ERC777 token standard solves these problems and offers new powerful features which facilitate new exciting use cases for tokens.

## Objective Of The Thesis

Our objective is to identify and describe the current issues and shortcomings of Ethereum's ERC20 token standard in order to create a more advanced token standard, ERC777 which not only solves the drawbacks of ERC20 but provides new powerful features which facilitate new and exciting use cases for tokens. The goals include better safety for token holders, improved usability, enhanced and more complex interactions between parties when creating, exchanging, and destroying tokens, and last but not least, wide adoption by the Ethereum community.

A part of this thesis' objective is to provide, as well, a reference implementation of the ERC777 advanced token standard which is not only used as an example but provides a modular structure such that token designers can build their own token on top of the reference implementation, thusly avoiding common programming mistakes.

## Challenges

Writing a standard requires the ability to define specifications which have to be versatile and adaptable within strict confines. Therefore, on the one hand, the standard needs to be generic enough to be adopted and used by a large number of people. On the other hand, its definition needs to be precise and explicit enough to avoid any ambiguities, conflicting conditions or undefined scenarios which can be a recipe for disaster. The language of the standard must also be clear but succinct and easily understandable by non-native and non-proficient English speakers.

Finally, the core goal of the standard is to be accepted and used by as many members of the Ethereum community as possible. We decided the best approach to tackle this challenge is to build the standard with the community as much as possible by asking for their thoughts and feedback and incorporate it in the standard as much as possible, as with the `tokensToSend` hook.

## Description Of The Work

This thesis is composed of ten chapters, commencing with the introduction which includes this section, together with the motivation, objective and challenges of the thesis.

Chapter \ref{ethereum-a-decentralised-computing-platform} begins by introducing the relevant aspects of the Ethereum ecosystem such as the ether currency, the notion of gas, the way fees are computed, the different types of accounts, Ethereum transactions and messages, the \gls{evm} and the high level Solidity language for smart contracts; which goes into specifics of the Solidity language---required to understand the meaning of the code outlined in the thesis---like state variables, function modifiers, events, view functions, the fallback function. Finally, we describe a notation based on \gls{uml} sequence diagrams used to visualise interactions and transactions between various entities.

Chapter \ref{tokens-and-standardisation}, provides a generic definition of a token with respect to the Ethereum ecosystem, and how they are traditionally implemented. We then argue about how standardisation can empower users to more easily and safely use tokens and how the use of a standard-compliant token can help its adoption. We continue by describing the process by which standards in Ethereum are catalogued and how anyone is able to submit a new standard proposal---such as the ones described later in this thesis. By the end of chapter \ref{tokens-and-standardisation} we provide a table and a genealogical tree comparing the Ethereum standards and standard proposals related to tokens.

Chapter \ref{erc20-token-standard} describe ERC20, the current token standard. It provides a description of the standard itself and the mechanisms used to transfer tokens. Next, we provided a detailed analysis of the strengths and weaknesses of the ERC20 token standard, together with the description of one critical flaw in the standard allowing an attacker to transfer more tokens than intended from a victim's account.

Chapter \ref{erc777-a-new-advanced-token-standard-for-ethereum-tokens} introduces the new and advanced token standard proposal which was developed as part of this thesis: ERC777. We begin by defining operators and hooks, two new concepts brought by ERC777 and followed by describing the sending, minting and burning mechanisms specified in the standard. Next, we explain the other relevant aspects of ERC777 such as the addition---with respect to ERC20---of the `data` and `operatorData` parameters when moving tokens, the view functions required by ERC777, and the approach taken to deal with decimals. Subsequently, we discuss the compatibility between ERC20 and ERC777. Afterwards, we elaborate on the interaction with the community and the public as well as the elaboration of the ERC777 logo which is also part of the standard. Finally, we comment on the reference implementation, a full implementation of an ERC777-compliant token and how the implementation is designed in a way to promote reusability and assist blockchain developers to create ERC777-compliant tokens with ease.

Chapter \ref{erc820-pseudo-introspection-registry-contract} covers the ERC820 pseudo introspection registry contract, a second standard proposal describing a registry we had to submit to enable some of the core features of ERC777, namely hooks and preventing accidental locking of tokens. We initially describe the two previous attempts to solve this registry problem and how both attempts revealed ill-suited for ERC777. Next, we go over the decision and reasons to provide the registry as a separate standard proposal---independently of ERC777---rather than bundling everything in a single standard. We cover the functions of the registry and the compatibility with ERC165 including the caching of ERC165 interfaces within the registry. In the end, we describe the lesser-known and somewhat unusual keyless deployment method which allows the registry to have a single address across all chains. Besides we explain as well how we achieved to have a vanity address starting with `0x820`.

In chapter \ref{competing-token-standards}, we analyses---besides ERC777---two of the most popular token-related proposals: the "ERC223 token standard"\citep{erc223} and the "ERC827 Token Standard (ERC20 Extension)"\citep{erc827}. We go over the different approaches---with respect to ERC777---taken by these standards to solve the issues of ERC20, and the issues with those approaches including the known vulnerabilities they contain. This analysis also includes the current issues from which both proposals suffer, including a flaw which resulted in the fraudulent minting of eleven million tokens on a vulnerable token contract.

Chapter \ref{the-state-of-tooling-in-the-ethereum-ecosystem} goes over the current state of tools in the Ethereum ecosystem, our experiences with those tools, the effect their quality and maturity had on the rest of the work outlined in this thesis and the contributions we brought to some of the tools during the development of this thesis. We finish by identifying the need for a gas profiler---which is recognised by members of the Ethereum community as one of the tools which are missing---and we elaborate the importance and uses for such a tool.

Chapter \ref{future-research-and-work} covers the work which remains to be done until ERC777 is formally accepted and widely adopted by the community. This includes the formal verification of the reference implementation which is already ongoing by an independent third party, the need to research and develop generic hooks and operators for ERC777, the community work to promote the standard and any form of assistance we provide to blockchain developers working on ERC77 tokens, related tools, and \glspl{dapp}.

Finally, in chapter \ref{conclusion} we conclude the work of this thesis by synthesising the work outlined in the thesis and how ERC777 can improve the Ethereum ecosystem and solve some of its current issues.
